{% load static %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="{% static 'logo.svg' %}">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/@picocss/pico@next/css/pico.min.css" />
    <link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora">
    <link rel="stylesheet" href="{% static "css/sentient.css" %}">
    <script>
		const user = '{{ request.user }}'

		function getCookie(name) {
		    let cookieValue = null;
		    if (document.cookie && document.cookie !== '') {
		        const cookies = document.cookie.split(';');
		        for (let i = 0; i < cookies.length; i++) {
		            const cookie = cookies[i].trim();
		            // Does this cookie string begin with the name we want?
		            if (cookie.substring(0, name.length + 1) === (name + '=')) {
		                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
		                break;
		            }
		        }
		    }
		    return cookieValue;
		}
		var csrftoken = getCookie('csrftoken');
		var cart = JSON.parse(getCookie('cart'));
		var wishlist = JSON.parse(getCookie('wishlist'));

		console.log('Cart:', cart)
		console.log('Wishlist:', wishlist)

		if (cart == null) {
			cart = {}
			console.log('Cart was created!')
			document.cookie = 'cart=' + JSON.stringify(cart) + ';domain=;path=/;'
		}
		if (wishlist == null) {
			wishlist = {}
			console.log('Wishlist was created!')
			document.cookie = 'wishlist=' + JSON.stringify(wishlist) + ';domain=;path=/;'
		}

    </script>
    {% if title %}
      <title>Bookshelf - {{ title }}</title>
    {% else %}
      <title>Bookshelf</title>
    {% endif %}
  </head>
  <body class="container">
    <!-- Navbar -->
    <div class="navbar">
      <nav>
        <ul>
          <li>
            <a href="{% url 'shop-home' %}" class="navbar__brand">
              <img class="brand__logo" src="{% static 'logo.svg' %}">
              <span class="brand__text">BookShelf</span>
            </a>
          </li>
        </ul>
        <ul class="navbar__links" data-visible="false">
          {% for section in sections %}
            <li>
              <details class="dropdown">
                <summary>{{ section.category }}</summary>
                <ul dir="rtl">
                  {% for genre in section.genres %}
                    <li>
                      <a href="{% url 'shop-books-genre' genre.slug %}">{{ genre.name }}</a>
                    </li>
                  {% endfor %}
                </ul>
              </details>
            </li>
          {% endfor %}
          <li></li>
          <li>
            <a href="{% url 'shop-about' %}">About us</a>
          </li>
          <li>
            <a href="{% url 'shop-contacts' %}">Contacts</a>
          </li>
        </ul>
        <ul>
          <li>
            <a href="{% url 'wishlist' %}"
               data-tooltip="Wishlist"
               data-placement="bottom">
              <svg xmlns="http://www.w3.org/2000/svg" width="2rem" height="2rem" viewBox="0 0 24 24">
                <path fill="currentColor" fill-rule="evenodd" d="M3.25 10.03c0-2.7 2.37-4.78 5.15-4.78c1.433 0 2.695.672 3.6 1.542c.905-.87 2.166-1.542 3.6-1.542c2.78 0 5.15 2.08 5.15 4.78c0 1.85-.789 3.476-1.882 4.852c-1.09 1.372-2.518 2.537-3.884 3.484c-.523.362-1.05.695-1.534.941c-.453.231-.975.443-1.45.443s-.996-.212-1.45-.443a14 14 0 0 1-1.533-.941c-1.367-.947-2.794-2.112-3.885-3.484C4.039 13.506 3.25 11.88 3.25 10.03M8.4 6.75c-2.08 0-3.65 1.53-3.65 3.28c0 1.403.596 2.71 1.556 3.918c.962 1.21 2.257 2.279 3.565 3.185c.495.343.96.634 1.36.838c.428.218.676.279.769.279s.341-.061.77-.28a12 12 0 0 0 1.36-.837c1.307-.906 2.602-1.974 3.564-3.185c.96-1.208 1.556-2.515 1.556-3.918c0-1.75-1.57-3.28-3.65-3.28c-1.194 0-2.31.713-3.005 1.619a.75.75 0 0 1-1.19 0C10.71 7.463 9.595 6.75 8.4 6.75" clip-rule="evenodd" />
              </svg>
              {% if not wishlist_item_count == 0 %}<span class="qty"><small>{{ wishlist_item_count }}</small></span>{% endif %}
            </a>
          </li>
          <li>
            <a href="{% url 'cart' %}" data-tooltip="Cart" data-placement="bottom">
              <svg xmlns="http://www.w3.org/2000/svg" width="2rem" height="2rem" viewBox="0 0 24 24">
                <path fill="currentColor" fill-rule="evenodd" d="M19.148 5.25H5.335l-1.18-2.115A.75.75 0 0 0 3.5 2.75H2a.75.75 0 0 0 0 1.5h1.06l1.164 2.088L6.91 12.28l.003.006l.237.523l-2.697 2.877a.75.75 0 0 0 .462 1.258l2.458.281a40.7 40.7 0 0 0 9.254 0l2.458-.28a.75.75 0 0 0-.17-1.491l-2.458.28a39.3 39.3 0 0 1-8.914 0l-.975-.11l1.98-2.112l.053-.064l.752.098c1.055.138 2.122.165 3.182.08a9.3 9.3 0 0 0 6.366-3.268l.579-.685l.053-.072l1.078-1.642c.764-1.164-.071-2.71-1.463-2.71M8.656 11.944a.48.48 0 0 1-.377-.278l-.002-.003l-2.22-4.913h13.09a.25.25 0 0 1 .21.387l-1.053 1.604l-.549.65a7.8 7.8 0 0 1-5.338 2.741c-.957.076-1.919.052-2.87-.072z" clip-rule="evenodd" />
                <path fill="currentColor" d="M6.5 18.5a1.5 1.5 0 1 0 0 3a1.5 1.5 0 0 0 0-3M16 20a1.5 1.5 0 1 1 3 0a1.5 1.5 0 0 1-3 0" />
              </svg>
              {% if not cart_item_count == 0 %}<span class="qty"><small>{{ cart_item_count }}</small></span>{% endif %}
            </a>
          </li>
          <li>
            {% if user.is_authenticated %}
              <a href="{% url 'profile' %}"
                 data-tooltip="Profile"
                 data-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" width="2rem" height="2rem" viewBox="0 0 24 24">
                  <path fill="currentColor" d="M12 3.75a3.75 3.75 0 1 0 0 7.5a3.75 3.75 0 0 0 0-7.5m-4 9.5A3.75 3.75 0 0 0 4.25 17v1.188c0 .754.546 1.396 1.29 1.517c4.278.699 8.642.699 12.92 0a1.54 1.54 0 0 0 1.29-1.517V17A3.75 3.75 0 0 0 16 13.25h-.34q-.28.001-.544.086l-.866.283a7.25 7.25 0 0 1-4.5 0l-.866-.283a1.8 1.8 0 0 0-.543-.086z" />
                </svg>
              </a>
            {% else %}
              <a href="{% url 'login' %}"
                 data-tooltip="Log In"
                 data-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" width="2rem" height="2rem" viewBox="0 0 24 24">
                  <path fill="currentColor" fill-rule="evenodd" d="M7.75 7.5a4.25 4.25 0 1 1 8.5 0a4.25 4.25 0 0 1-8.5 0M12 4.75a2.75 2.75 0 1 0 0 5.5a2.75 2.75 0 0 0 0-5.5m-4 10A2.25 2.25 0 0 0 5.75 17v1.188c0 .018.013.034.031.037c4.119.672 8.32.672 12.438 0a.04.04 0 0 0 .031-.037V17A2.25 2.25 0 0 0 16 14.75h-.34a.3.3 0 0 0-.079.012l-.865.283a8.75 8.75 0 0 1-5.432 0l-.866-.283a.3.3 0 0 0-.077-.012zM4.25 17A3.75 3.75 0 0 1 8 13.25h.34q.28.001.544.086l.866.283a7.25 7.25 0 0 0 4.5 0l.866-.283c.175-.057.359-.086.543-.086H16A3.75 3.75 0 0 1 19.75 17v1.188c0 .754-.546 1.396-1.29 1.517a40.1 40.1 0 0 1-12.92 0a1.54 1.54 0 0 1-1.29-1.517z" clip-rule="evenodd" />
                </svg>
              </a>
            {% endif %}
          </li>
        </ul>
        <ul class="navbar__menu-toggle">
          <li>
            <div class="menu-btn">
              <div class="menu-btn__burger"></div>
            </div>
          </li>
        </ul>
      </nav>
      <div data-visible="false" class="mobile-highlight"></div>
    </div>
    <!-- Main content -->
    <main class="container">
      <!-- Messages -->
      {% if messages %}
        {% for message in messages %}<div class="alert alert-{{ message.tags }}" role="alert">{{ message }}</div>{% endfor %}
      {% endif %}
      {% block content %}{% endblock %}
    </main>
    <!-- Scripts -->
    <script type="text/javascript" src="{% static 'js/javascript.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/cart.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/modal.js' %}"></script>
  </body>
</html>
